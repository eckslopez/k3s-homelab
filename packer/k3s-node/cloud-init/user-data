#cloud-config

# Set password for ubuntu user (most reliable method)
chpasswd:
  list: |
    ubuntu:ubuntu
  expire: false

# Enable password authentication
ssh_pwauth: true

# Configure ubuntu user
users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    shell: /bin/bash
    lock_passwd: false

# Ensure sudo works without password
runcmd:
  - echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /etc/sudoers.d/ubuntu
  - chmod 440 /etc/sudoers.d/ubuntu
